"use strict";(()=>{var e={};e.id=331,e.ids=[331],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7669:(e,t,n)=>{n.r(t),n.d(t,{headerHooks:()=>p,originalPathname:()=>f,requestAsyncStorage:()=>l,routeModule:()=>o,serverHooks:()=>d,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>c});var i={};n.r(i),n.d(i,{GET:()=>GET,POST:()=>POST});var r=n(884),a=n(6132),s=n(7342);function randomCode(e=6){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="";for(let i=0;i<e;i++)n+=t[Math.floor(Math.random()*t.length)];return n}function isValidCustomCode(e){return/^[A-Za-z0-9]{6,8}$/.test(e)}function isValidUrl(e){try{return new URL(e),!0}catch{return!1}}async function GET(e,t){let n=await s.Z.link.findMany({orderBy:{createdAt:"desc"}});return new Response(JSON.stringify(n),{status:200,headers:{"content-type":"application/json"}})}async function POST(e){let t=await e.json(),{url:n,code:i}=t??{};if(!n||!isValidUrl(n))return new Response(JSON.stringify({error:"Invalid or missing URL"}),{status:400,headers:{"content-type":"application/json"}});let r=i;if(r){if(!isValidCustomCode(r))return new Response(JSON.stringify({error:"Custom code must match [A-Za-z0-9]{6,8}"}),{status:400,headers:{"content-type":"application/json"}});let e=await s.Z.link.findUnique({where:{code:r}});if(e)return new Response(JSON.stringify({error:"Code already exists"}),{status:409,headers:{"content-type":"application/json"}})}else{let e=0;do{r=randomCode(6);let t=await s.Z.link.findUnique({where:{code:r}});if(!t)break;e++}while(e<5);r||(r=randomCode(7))}let a=await s.Z.link.create({data:{code:r,url:n}});return new Response(JSON.stringify(a),{status:201,headers:{"content-type":"application/json"}})}let o=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/links/route",pathname:"/api/links",filename:"route",bundlePath:"app/api/links/route"},resolvedPagePath:"D:\\DSA Prepaaration\\tinylink\\tinylink\\app\\api\\links\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:u,serverHooks:d,headerHooks:p,staticGenerationBailout:c}=o,f="/api/links/route"},7342:(e,t,n)=>{n.d(t,{Z:()=>a});let i=require("@prisma/client"),r=globalThis;r.prisma||(r.prisma=new i.PrismaClient);let a=r.prisma}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),n=t.X(0,[729],()=>__webpack_exec__(7669));module.exports=n})();